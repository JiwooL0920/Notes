# 1. SDLC Automation

| Scenario<br>                                                                                                                                                         | Solution                                                                                                                                                                                        |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Automatically detect and prevent hardcoded secrets within CodeCommit repo                                                                                            | Link CodeCommit repo to CodeGuru Reviewer to detect secrets in source code or configuration files                                                                                               |
| An Elastic Banstalk app must not have any downtime during deployment and requires an easy rollback to previous version if issue occurs                               | Set up Blue/Green deployment, deploy a new version on a separate environment, then swap environment URLs on Elastic Beanstalk                                                                   |
| A new version of a Lambda app is ready to be deployed and deployment shouldn’t cause any downtime. A quick rollback to the previous Lambda version must be available | Publish a new version of the Lambda function. After testing, use the prod Lambda Alias to point to this new version                                                                             |
| In a Lambda deployment, only 10% of the incoming traffic should be routed to the new version to verify the changes before eventually allowing all prod traffic       | Set up Canary deployment for Lambda. Create a Lambda Alias pointed to the new Version. Set Weighted Alias value for this Alias as 10%                                                           |
| ==An app hosted in EC2 instances behind an ALB.== You must provide a safe way to upgrade the version on Production and allow easy rollback to the previous version   | Launch the app in EC2 that runs the new version with ALB in front. Use ==Route 53== to change the ALB A-record Alias to the new ALB URL. Rollback by changing the A-record Alias to the old ALB |
| An ==OpsWork== app needs to safely deploy its new version on the prod env. You’re tasked to prepare a rollback process in case of error<br>                          | Clone the OpsWork Stack. Test it with the new URL of the cloud env. Update Route53 record to point to the new version                                                                           |
| Dev team needs full access to CodeCommit but they shouldn’t be able to create/delete repos                                                                           | Assign devs with ==`AWSCodeCommitPowerUser`== IAM policy<br>                                                                                                                                    |
| During deployment, you need to run custom actions before deploying new version of the app using CodeDeploy                                                           | Add a lifecycle hook action `BeforeAllowTraffic`                                                                                                                                                |
| You need to run custom verification actions after the new version is deployed using CodeDeploy                                                                       | Add lifecycle hook action `AfterAllowTraffic`                                                                                                                                                   |
| You need to set up CodeBuild to automatically run after a PR has been successfully merged using CodeCommit                                                           | Create EventBridge Rule to detect PR and action set to trigger CodeBuild project. Use Lambda to update the PR with the result of the project Build                                              |
| You need to use CodeBuild to create artifact and auto deploy the new app version                                                                                     | Set CodeBuild to save artifacts to S3 bucket. Use CodePipeline to deploy using CodeDeploy and set the build artifact from the CodeBuild output                                                  |
| You need to upload the CodeBuild artifact to S3                                                                                                                      | S3 bucket needs to have versioning and encryption enabled                                                                                                                                       |
| You need to review CodeBuild Logs and have an alarm notification for build results on Slack                                                                          | Send CodeBuild logs to CloudWatch Log group. Create an EventBridge rule to detect the result of your build and target a Lambda function to send result to Slack channel (or SNS notification)   |
| Need to run CodePipeline everyday for updating the development progress status                                                                                       | Create an EventBridge rule to run on schedule everyday and set a target to CodePipeline ARN                                                                                                     |
| Automate deployment of a Lambda function and test for only 10% of traffic for 10 min before allowing 100% traffic flo                                                | Use CodeDeploy and select development configuration `CodeDeployDefault.LambdaCanary10Percent10Minutes`                                                                                          |
| Deployment of Elastic Beanstalk app with absolutely no downtime. The solution must maintain full compute capacity during deployment to avoid service degradation     | Choose the `Rolling with additional Batch` deployment policy in Elastic Beanstalk                                                                                                               |
| Deployment of Elastic Beanstalk app where the new version must not be mixed with the current version                                                                 | Choose the `immutable deployments` deployment policy in Elastic Beanstalk                                                                                                                       |

# 2. Configuration Management and IaC

| Scenario<br>                                                                                                                     | Solution                                                                                                                                                                                      |
| -------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| The resources of the parent CloudFormation stack needs to be referenced by other nested CloudFormation stacks                    | Use `Export` and `Output` field of the main CloudFormation stack and use `Fn::ImportValue` function to import the value on the other stacks                                                   |
| On which part of the CloudFormation template should you define the artifact zip file on the S3 bucket?                           | The artifact file is defined on the `AWS::Lambda::Function` code resource block                                                                                                               |
| Need to define the Lambda function inline in the CloudFormation template                                                         | On the `AWS::Lambda::Function` code resource block, the inline function must be enclosed inside the `ZipFile` section                                                                         |
| Use CloudFormation to update ASG and only terminate the old instances when the newly launched instances become fully operational | Set `AutoScalingReplacingUpdate: WillReplace` property to `TRUE` to have CloudFormation retain the old ASG until the instances of the new ASG are healthy                                     |
| You need to scale-down the EC2 instances at night when there is a low traffic using OpsWork                                      | Create `time-based` instances for automatic scaling of predictable workload                                                                                                                   |
| Can’t install an agent on on-premises servers but need to collect information for migration                                      | Deploy the ==Agentless Discovery Connector VM== on you on-premise data centre to collect info                                                                                                 |
| Syntax for CloudFormation with an ECS cluster with ALB                                                                           | Use the `AWS::ECS::Service` element for the ECS Cluster, `AWS::ECS::TaskDefinition` element for ECS Task Definitions, and the `AWS::ElasticLoadBalancingV2::LoadBalancer` element for the ALB |

# 3. Resilient Cloud Solutions

| Scenario<br>                                                                                                                                   | Solution                                                                                                                                                         |
| ---------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Need to deploy stacks across multiple AWS accounts/regions                                                                                     | Use CloudFormation StackSets to extend the capability of stacks to create, update, or delete stacks across multiple accounts and regions with a single operation |
| Need to ensure that both the application and database are running in the event that one AZ becomes unavailable                                 | Deploy your app on multiple AZs and set up your RDS database to use Multi-AZ Deployments                                                                         |
| In the event of an AWS region outage, you have to make sure that both your app and database will still be running to avoid any service outages | Create a copy of your deployment on the backup AWS region. Set up an RDS Read-Replica on the backup region                                                       |
| Automatically switch traffic to the backup region when your primary AWS region fails                                                           | Set up Route53 Failover routing policy with health check enabled on your primary region endpoint                                                                 |
| Need to ensure the availability of a legacy application running on a single EC2 instance                                                       | Set up ASG with `MinSize=1` and `MaxSize=1` configuration to set a fixed count and ensure that it will be replaced when the instance becomes unhealthy           |
| Ensure that every EC2 instance on an ASG downloads the latest code first before being attached to the load balancer                            | Create an Auto Scaling Lifecycle Hook and configure `Pending:Wait` hook with the action t o download all necessary packages                                      |
| Ensure that all EC2 instances of an ASG upload all log files in the S3 bucket before being terminated                                          | Use the Auto Scaling Lifecycle and configure `Terminating:Wait` hook with the action to upload all logs to the S3 bucket                                         |

# 4. Monitoring and Logging

| Scenario<br>                                                                                             | Solution                                                                                                                                                    |
| -------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Need to centralize audit and collect config settings on all regions of multiple accounts                 | Setup an Aggregator on AWS Config                                                                                                                           |
| Consolidate CloudTrail log files from multiple AWS accounts                                              | Create a central S3 bucket with bucket policy to grant cross-account permission. Set this as destination bucket on the CloudTrail of the other AWS accounts |
| Ensure that CloudTrail logs on the S3 bucket are protected and can’t be tampered with                    | Enable Log File Validation on CloudTrail settings                                                                                                           |
| Need to collect/investigate app logs from EC2 or on-premise server                                       | Install the unified CloudWatch Agent to send the logs to CloudWatch Logs for storage and viewing                                                            |
| Need to review logs from running ECS Fargate tasks                                                       | Enable `awslogs` log driver on the Task Definition and add the required `logConfiguration` parameter                                                        |
| Need to run real-time analysis for collected app logs                                                    | Send logs to CloudWatch Logs, create a Lambda subscription filter, Elasticsarch subscription filter, or Kinesis stream filter                               |
| Need to be automatically notified if you are reaching the limit of running EC2 instances or limit of ASG | Track service limits with Trusted Advisor on CloudWatch Alarms using the `ServiceLimitUsage` metric                                                         |
| Need a near real-time dashboard with a feature to detect violations for compliance                       | Use AWS Config to record all config changes and store the data reports to S3. Use QuickSight to analyze the dataset                                         |

# 5. Incident and Event Response

| Scenario<br>                                                                                                             | Solution                                                                                                                                                                                             |
| ------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| There are missing assets in File Gateway but exist directly in the S3 bucket                                             | Run the `RefreshCache` command for Storage Gateway to refresh the cached inventory of objects for the specified file share                                                                           |
| Need to filter certain event in CloudWatch Logs                                                                          | Setup a CloudWatch metric filter to search the particular event                                                                                                                                      |
| Need to get a notification if somebody deletes files in your S3 bucket                                                   | Set up S3 Event Notifications to get notifications based on specified S3 events on a particular bucket                                                                                               |
| Need to be notified when an RDS Multi-AZ failover happens                                                                | Set up RDS Event Notifications to detect specific events on RDS                                                                                                                                      |
| Get a notification if somebody updated IAM access keys on any public GitHub repo                                         | Create an EventBridge Rule for the `AWS_RISK_CREDENTIALS_EXPOSED` event from AWS ==Health Service==. Use Step Functions to automatically delete the IAM key                                          |
| Get notified on Slack when your EC2 instance is having an AWS-initiated maintenance event                                | Create an EventBridge rule for the AWS Health Service to detect EC2 Events. Target a Lambda function that will send a notification to the Slack channel                                              |
| Get notified of any AWS maintenance events that may impact your EC2 or RDS instances                                     | Create an EventBridge rule for detecting any events on Health Service and send a message to an SNS topic or invoke a Lambda function                                                                 |
| Monitor scaling events of your EC2 ASG such as launching/terminating an EC2 instance                                     | Use EventBridge Events for monitoring the Auto Scaling Service and monitor the `EC2 Instance-Launch Successful` and `EC2 Instance-Terminate Successful` events                                       |
| View object-level actions of S3 buckets such as upload or deletion of object in CloudTrail                               | Setup ==Data Events== on your CloudTrail trail to record object-level API activity on your S3 buckets                                                                                                |
| Execute a custom action if a specific CodePipeline stage has a `FAILED` status                                           | Create an EventBridge rule that detect failed state on the CodePipeline service, and set a target to SNS topic for notification or invoke a Lambda function to perform custom action                 |
| Automatically rollback a deployment in CodeDeploy when the number of healthy instances is lower than the min requirement | On CodeDeploy, create a deployment alarm that is integrated with CloudWatch. Track the `MinimumHealthyHosts` metric for the threshold of EC2 instances and trigger the rollback if alarm is breached |
| Need to complete QA testing before deploying a new version to the prod env                                               | Add a Manual Approval step on CodePipeline, and instruct the QA team to approve the step before the pipeline can resume the deployment                                                               |
| Get notified for OpsWorks auto-healing events                                                                            | Create an EventBridge rule for the OpsWork Service to track the `auto-healing` events                                                                                                                |

# 6. Security and Compliance

| Scenario<br>                                                                                                       | Solution                                                                                                                                                                         |
| ------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Need to monitor the latest ==Common Vulnerabilities and Exposures (CVE)== of EC2 instances                         | Use Inspector to automate security vulnerability assessments to test the network accessibility of the EC2 instances and the security state of the apps that run on the instances |
| Need to secure the `buildspec.yml` file which contains the AWS keys and database password stored in plaintext      | Store these values as encrypted parameter on SSM Parameter Store                                                                                                                 |
| Using default IAM policies `AWSCodeCommitPowerUser` but must be limited to a specific repo only                    | Attach additional policy with `Deny` rule and custom condition if it doesn’t match the specific repo or branch                                                                   |
| You need to secure an S3 bucket by ensuring that only HTTPS requests are allowed for compliance purposes           | Create an S3 bucket policy that `Deny` if checks for condition `aws:SecureTransport` is `false`                                                                                  |
| Need to generate a secret password and have it rotated automatically at regular intervals                          | Store the secret on AWS Secrets Manager and enable key rotation                                                                                                                  |
| Several team members, with designated roles, need to be granted permission to use AWS resources                    | Assign AWS managed policies on the IAM accounts such as `ReadOnlyAccess`, `AdministratorAccess`, `PowerUserAccess`                                                               |
| Apply latest patches on EC2 and automatically create an AMI                                                        | Use Systems Manager automation to execute Automation Document that installs OS patches and creates a new AMI                                                                     |
| Need to have a secure SSH connection to EC2 instances and have a record of all command executed during the session | Install SSM Agent on EC2 and use SSM Session Manager for the SSH access. Send the session logs to S3 bucket or CloudWatch Logs for auditing and review                           |
| Ensure that the managed EC2 instances have the correct app version and patches installed                           | Use SSM Inventory to have a visibility of your managed instances and identify their current configurations                                                                       |
| Apply custom patch baseline for a custom repo and schedule patches to managed instances                            | Use SSM Patch Manager to define a custom patch baseline and schedule the app patches using SSM Maintenance Windows                                                               |
|                                                                                                                    |                                                                                                                                                                                  |

