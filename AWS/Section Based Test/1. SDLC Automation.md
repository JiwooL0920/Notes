
| Scenario                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Answer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Deployed to ECS, need to run validation script before allowing prod traffic                                                                                                                                                                                                                                                                                                                                                                                                                        | Create validation script in Lambda and define them on `AfterAllowTestTraffic` lifecycle hook                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Trigger job in ECS when files are uploaded/deleted from S3 bucket. Object level logging is already enabled                                                                                                                                                                                                                                                                                                                                                                                         | Create 2 EventBridge rule to detect S3 object: PUT -> set target to ECS cluster to run a new ECS Task, DELETE -> set target to Lambda function to stop all ECS tasks with API call                                                                                                                                                                                                                                                                                                                                                    |
| EC2 running behind ASG. Deploy duplicate fleet, keep original fleet unaltered. Shift traffic once completely deployed, and auto terminate original fleet 1hr after.                                                                                                                                                                                                                                                                                                                                | CodeDeploy set up blue/green deployment group. Setup `BlueInstanceTerminationOption` action to `TERMINATE` and `terminationWaitTimeInMinutes` to 1hr                                                                                                                                                                                                                                                                                                                                                                                  |
| ECS - Keep db credentials in dedicated storage with lifecycle management and key rotation                                                                                                                                                                                                                                                                                                                                                                                                          | If you want a single store for configuration and secrets, you can use Parameter Store. If you want a dedicated secrets store with lifecycle management, use Secrets Manager                                                                                                                                                                                                                                                                                                                                                           |
| Codebuild is downloading from S3 in unauthenticated manner. Enhance it                                                                                                                                                                                                                                                                                                                                                                                                                             | Secure the S3 bucket by removing unauthenticated access thru a bucket policy. Update the service role of the CodeBuild project to grant access to S3. Download the db scripts using AWS CLI                                                                                                                                                                                                                                                                                                                                           |
| Project code on GitHub. Everytime the repo is updated, the code must be compiled, tested, and uploaded to S3                                                                                                                                                                                                                                                                                                                                                                                       | (1) Setup a GitHub webhook that will initiate a build process whenever there's a modification to repo. (2) Provision a CodeBuild project that utilizes GitHub as source repo. (3) Include a buildspec.yml file in the source code                                                                                                                                                                                                                                                                                                     |
| Deploying critical app with Elastic Beanstalk using `Rolling` deployment policy. It has an RDS DB instance attached to it. Deployment failed and you had to redeploy old version. Prevent it                                                                                                                                                                                                                                                                                                       | Configure `Immutable` as the deployment policy in your Elastic Beanstalk environment --> ensures that config changes that require replacing instances are applied efficiently/safely. If an immutable env update fails, the rollback process requires only terminating an ASG. (B/G is incorrect bc it requires your env to run independently of your prod db)                                                                                                                                                                        |
| Need a solution to collect all app/server logs effectively (EC2, multi-AZ behind ALB). Should be able to perform root cause analysis based on logs, even if ASG immediately terminated the instance                                                                                                                                                                                                                                                                                                | Delay termination of unhealthy EC2 instance by adding a lifecycle hook to ASG to move instances in `Terminating` state to `Terminating:Wait` state. Create EventBridge rule for `EC2 Instance-terminate Lifecycle Action` Auto Scaling Event with an associated AWS Systems Manager Automation Document. Trigger CloudWatch agent to push app logs and resume instance termination once all logs are sent to CloudWatch Logs                                                                                                          |
| ECS in VPC. Need an app to detect where high latencies are occurring and determining specific services and paths impacting app performance                                                                                                                                                                                                                                                                                                                                                         | Produce a Docker image that runs the X-Ray daemon. Upload the image to a Docker image repository, and then deploy it to your ECS cluster. Configure network mode settings and port mappings in your **task definition file** to allow traffic on **UDP** port 2000                                                                                                                                                                                                                                                                    |
| Design a deployment strategy for serverless architecture that retains the ability to test new features with a limited set of users before making it accessible to the entire user base. Use Lambda and API Gateway                                                                                                                                                                                                                                                                                 | Deploy Lambda functions with versions and API Gateway using CloudFormation. When there are code changes, update the CloudFormtion stack with the new Lambda code then a canary release strategy should be used to update the API versions. Once testing is done, promote the new version.                                                                                                                                                                                                                                             |
| Plans to rearchitect using serverless architecture. Need to try out new features on a limited number of users before releasing traffic to all users. It’ll use Lambda and API Gateway.                                                                                                                                                                                                                                                                                                             | Deploy API Gateway + Lambda by utilizing Serverless Application Model (SAM). For code changes, update the CloudFormation stack and deploy the updated versions of APIs and Lambda functions. Implement a canary release strategy by setting the `DeploymentPreference` type to `Canary10Percent10Minutes`                                                                                                                                                                                                                             |
| Connected to on-premise (50TB tape library) with Direct Connect. Implement automated catalog system to search files using facial recognition                                                                                                                                                                                                                                                                                                                                                       | Connect on-premise file system to Storage Gateway by setting up a file gateway appliance on-premises. Use MAM solution to extract media files from current data store and send them into file gateway. Populate a collection using Rekognition by building a catalog of faces from the processed media files. Launch a Lambda function to invoke Rekognition SDK to have it fetch the media files from S3 bucket which is backing the file gateway. Retrieve the needed metadata using Lambda and store the info into MAM solution    |
| Millions of users for game app + multi- region. Date residency requirement - all files must retain in the same region. GitHub, CodeBuild, CodeDeploy, and CodePipeline should be utilized to build CI/CD.                                                                                                                                                                                                                                                                                          | Create a new pipeline using CodePipeline and GitHub repo as source in your primary region. Configure repo to trigger build and deployment actions whenever there is a new code update. Using AWS Management Console, set up the pipeline to use **cross region actions** that will run the build/deployment to other regions. The pipeline will automatically store output files on a default artifact bucket on each region                                                                                                          |
| App deployed across multiple AZs using ALB. App is hosted on EC2 instances spread across these zones to ensure high availability. Some instances in one AZ are experiencing issue. We must isolate the impacted instances and use failover mechanism to direct traffic to healthy ones                                                                                                                                                                                                             | Disable Cross-Zone Load Balancing on ALB and use **Route53 Application Recovery Controller** to initiate a **zonal shift** to avoid the impacted zone entirely                                                                                                                                                                                                                                                                                                                                                                        |
| A new fleet of EC2 instances should be automatically launched first before the actual prod deployment. Must be load balanced and auto heal. At least half of the incoming traffic must be rerouted to the new app version. Deployment considered successful if traffic is rerouted to at east half of the available EC2 instances. All temporary files must be deleted before routing traffic to the new fleet of instances. EC2 instance that host the old version must be terminated immediately | Launch an ALB and use a B/G deployment. Associate ALG and ALB target group with the deployment group. Create a custom deployment config for the deployment group in CodeDeploy with minimum healthy host defined as 50% and configure it to also terminate the original instances in the ASG after deployment. Use the `BeforeAllowTraffic` hook within `appspec.yml` to purge the temporary files                                                                                                                                    |
| Automate the process of generating AMIs to streamline CI/CD. The ID of the newly created AMI must be stored in a centralized location where other build pipelines can programmatically access it                                                                                                                                                                                                                                                                                                   | Using Systems Manager, create an Automation document with values that configure how the machine image should be created. Launch a new pipeline with a custom action in CodePipeline and integrate it with EventBridge to execute the automation document. Build the AMI when the process is triggered. Store the AMI IDs in Systems Manager Parameter Store                                                                                                                                                                           |
| A security code review must be done to ensure that there is no leaked Personally Identifiable Information (PII) or other sensitive data. Send email                                                                                                                                                                                                                                                                                                                                                | Configure CodePipeline to start when there is code change in a certain branch. Set up required stages for security review, unit/functional test, and manual approval. Use EventBridge to detect changes in pipeline stages. Send email notification using SNS (Not SES --it's primarily a bulk/transactional email service and requires additional config such as setting up identities and templates)                                                                                                                                |
| EKS cluster, integrated OIDC issuer and is configuring EBS gp3 volumes for persistent storage. When trying to create a PVC, it failed to provision volume with StorageClass and could not create volume in `EC2: UnauthorizedOperation`                                                                                                                                                                                                                                                            | Configure IAM role specifically for the **EBS Container Storage Interface (CSI) driver** (responsible for integrating Kubernetes with EBS), assigning it the necessary permissions and trust policies. Attach this role to the EBS CSI driver add-on to enable it to provision and manage EBS volumes                                                                                                                                                                                                                                 |
| Uses SAM templates. Username and password for auth to db are hardcoded within GitHub repo. Automatically detect and prevent hardcoded secrets. Automatic secret rotation should also be implemented                                                                                                                                                                                                                                                                                                | Link the GitHub repositories to **CodeGuru Reviewer**. Perform a manual evaluation of the code review for any recommendations. Select the option to protect the secret. Revise the SAM templates and Python code to fetch the secret from **Secrets Manager**                                                                                                                                                                                                                                                                         |
| Dev team pushes new image to private Docker registry whenever they publish a new version of their app. They stop and start all tasks to ensure that the containers have the latest version. But tasks are occasionally running old image                                                                                                                                                                                                                                                           | Restart the **ECS Agent** (containerized process that runs on ECS container instances (EC2) and manages communication between the instance and the ECS service)                                                                                                                                                                                                                                                                                                                                                                       |
| Website takes a lot of time to load (fails with HTTP 504) - user logs. Configured CloudFront to serve static content but problem persists. Set up a solution with minimal cost                                                                                                                                                                                                                                                                                                                     | (1) Create an origin (primary/secondary) group with 2 origins to set up an origin failover in CloudFront. This config will cause CloudFront to automatically switch to the second origin in the event the primary origin returns specific HTTP status code failure responses. (2) Use Lambda@Edge to customize the content that the CloudFront distribution delivers to your users across the globe. This will allow the Lambda functions to execute authentication process in a specific AWS location that is proximate to the user. |
| Using CloudFormation templates to deploy app to prod/staging/dev env in AWS. Current process involves manual changes to CloudFormation templates in order to specify config variables and static attributes for each environment. Set up automated deployment using CodePipeline and ensure that CloudFormation template is reusable across multiple pipelines                                                                                                                                     | Launch a new pipeline using CodePipeline that has multiple stages for each environment and configure it to use input parameters. Switch the associated `UserData` of the EC2 instances to match the environment where the app stack is being launched using CloudFormation mappings. Specify parameter overrides for CloudFormation actions                                                                                                                                                                                           |



- Elastic Beanstalk can’t deploy Lambda and API Gateway
- Tape Gateway in AWS Storage Gateway is primarily used as an archive solution
- SAM deploys new versions of Lambda and automatically creates aliases that points to the new version
- CodePipeline can add actions to your pipeline that are in a diff region from your pipeline (cross-region action). You can use the console, CLI, or CloudFormation to add cross-region actions in pipelines. Provide artifact bucket for each region where you have actions. You must create the artifact bucket and encryption key in the same Region as the cross-region action in the same account as your pipeline. The region where your pipeline is hosted doesn’t change
- Route 53 Application Recovery Controller (ARC) allows you to implement highly reliable routing controls to manage traffic during app recovery scenarios — Simple ON/OFF switches hosted on a HA cluster, can reroute traffic from the impacted AZ to a healthy one
- Auto-scaling policies — focuses more on instance replacement rather than traffic management
