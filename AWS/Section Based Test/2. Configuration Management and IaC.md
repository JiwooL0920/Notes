
| Scenario                                                                                                                                                                                                                                                                                                                                                                                                                                           | Answer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Protect and encrypt the sensitive credit card info for users and improve cache hit ratio of your CloudFront distribution                                                                                                                                                                                                                                                                                                                           | Secure end-to-end connections to the origin servers in your CloudFront distribution by using HTTPS and field-level encryption. Set up your origin to add a `Cache-Control max-age` directive to your objects. Apply the longest practical value for `max-age` to increase your cache hit ratio                                                                                                                                                                                                                                |
| App hosted in ASG of on-demand EC2 instances with custom AMI. Dev, testing, staging, prod environments. Design a deployment strategy that securely stores the credentials of each environment, expediates the startup time for EC2 instances, and allows the same AMI to work in all environments                                                                                                                                                  | Add a tag to each EC2 instance based on their environment. Use Systems Manager Automation to preconfigure the AMI by installing all of required app/dependencies. Write a bootstrap script in User Data to analyze the tag and set the env config accordingly. Use Systems Manager Parameter Store to store the credentials as Secure String params                                                                                                                                                                           |
| Developing AI-powered traffic monitoring portal. Highly available and fault-tolerant. Automatically assesses app for exposure, vulnerabilities, and deviations from AWS best practices                                                                                                                                                                                                                                                             | Use Inspector for automated security assessment to help improve the security and compliance of your apps. Launch ASG of EC2 instances on 3 AZs. Set up ALB to distribute incoming traffic. Set up Aurora as the database tier. Using Route53, create an alias record for the root domain to point to the load balancer                                                                                                                                                                                                        |
| Canary deployment of Lambda + API Gateway                                                                                                                                                                                                                                                                                                                                                                                                          | Deploy app using Traffic Shifting with Lambda Aliases                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Implement an automated OS Patching solution for all Windows servers hosted on-premises as well as in AWS Cloud. Use Systems Manager                                                                                                                                                                                                                                                                                                                | (1) Download and install SSM Agent on hybrid servers using activation codes/IDs obtained. Register servers on-premise to Systems Manager service. In the SSM console, hybrid instances will have an `mi` prefix. Apply patches using Systems Manager patch manager. (2) Set up a single IAM service role for Systems Manager to enable the service to execute STS `AssumeRole` operation. Allow the generation of service tokens by registering the IAM role. Use the service role to perform the managed-instance activation |
| Uses encrypted S3 bucket to store credential files of its customers. Configured federated access to a particular AD user group from their on-premise network to allow access to S3 bucket. For audit purpose, need to automatically detect any policy changes that are related to the restricted federated access of the bucket and to have the ability to revert any accidental changes made by the admins. Fastest way to detect config changes? | Set up AWS Config rule with a configuration change trigger that will detect any changes in the S3 bucket config and which will also invoke Systems Manager Automation document with a Lambda function that will revert any changes                                                                                                                                                                                                                                                                                            |
| A new compliance rule that mandates a monthly audit of every Linux/Windows EC2 instances check for system performance issues. Each instance must have a logging function that collects various system details and retrieve custom metrics from installed applications or services. DevOps teams will periodically review these logs and analyze their contents                                                                                     | Configure and install unified CloudWatch Logs agent in each EC2 instance that will automatically collect and push data to CloudWatch Logs. Analyze the log data with CloudWatch Logs Insights                                                                                                                                                                                                                                                                                                                                 |
| App using Aurora MySQL db instance in the region where it's based. It aims to consolidate and store the data of its offerings to a single data source for its product catalog across all regions. To comply with data privacy regulations, they need to ensure that personal info of their users are kept in their respective regions. Meet requirement with least amount of change                                                                | Set up multiple read replicas in your Aurora cluster (can create rr in diff regions) to store the product catalog data. Launch an additional local Aurora instance in each Region for storing personal info                                                                                                                                                                                                                                                                                                                   |
| Ensure users remain logged in across scaling events and app deployments                                                                                                                                                                                                                                                                                                                                                                            | Launch a new ElastiCache for Redis cluster with nodes across multiple AZs. Configure the app to store user-session info in Elasticache.                                                                                                                                                                                                                                                                                                                                                                                       |
| Document management portal that utilize existing DynamoDB table. Table has an attribute of `DocumentName` and acts as the partition key and another attribute called `Category` as its sort key. Develop a feature that queries the `DocumentName` attribute yet uses a different sort key other than the existing one. To fetch the latest data, strong read consistency must be used in the database tier                                        | Set up a new DynamoDB table with a Local Secondary Index that uses the `DocumentName` Attribute with a different sort key. Migrate the data from the existing table to the new table.                                                                                                                                                                                                                                                                                                                                         |
| Using CloudFormation templates. Need automated solution to map the latest AMI IDs.                                                                                                                                                                                                                                                                                                                                                                 | Use Systems Manager Parameter Store in conjunction with CloudFormation to retrieve the latest AMI IDs for your template. Call the update-stack API in CloudFormation in your template whenever you decide to update the EC2 instances                                                                                                                                                                                                                                                                                         |
| Uses ASG of reserved EC2 instances with ALB in front. Need to set up CloudFront web distribution that uses a custom domain name where the origin is set to point to ALB. Need to set up end-to-end HTTPS connection from the origin to CloudFront viewer                                                                                                                                                                                           | Generate an SSL Certificate that’s signed by a trusted 3rd party cert authority. Import the cert into AWS Certificate Manager and use it for the ALB. Set the `Viewer Protocol Policy` to `HTTPS Only` in CloudFront and then use an SSL/TLS cert from a 3rd party cert authority which was imported to either AWS Cert Manager or the IAM certificate store                                                                                                                                                                  |
| Need to patch all of Windows EC2 instances. Important that Ec2 instance reboots don’t occur at the same time on all instances in order to maintain system uptime requirement                                                                                                                                                                                                                                                                       | Set up 2 Patch Groups with unique tags assigned to EC2 Windows instances. Associate predefined `AWS-DefaultPatchBaseline` on both patch groups. Set up 2 non-overlapping maintenance windows and associate each with a different patch group. Register targets with specific maintenance windows using Patch Group tags. Assign the `AWS-RunPatchBaseline` document as a task within each maintenance window which has a different processing start time.                                                                     |
| Hybrid deployment is required. Need secure access to db credentials, which must be encrypted both at rest and in transit. Most secure manner                                                                                                                                                                                                                                                                                                       | Using System Manager Parameter store, upload/manage db credentials with a Secure String data type. Create an IAM role with an attached policy that allows access/decryption of db credentials. Attach this role to the instance profile of CodeDeploy-managed instances as well as to on-premises instances using `register-on-premises-instance` command. Deploy the app packages to EC2 instances and on-premises servers using CodeDeploy                                                                                  |
| Migration — on-premise VMware servers and few EC2 instances in VPC. Need to collect info from their on-premise and EC2 instances such as OS details, MAC/IP address. Should be able to analyze collected data in a visual format. Least amount of effort                                                                                                                                                                                           | Using AWS Application Discovery Service, deploy the Agentless Discovery Connector in an OVA file format to your VMware VCenter and then install the AWS Discovery Agents on the EC2 instances to collect the required data. Use the AWS Migration Hub Dashboard to analyze your hybrid infra.                                                                                                                                                                                                                                 |
| Storing credentials in env of buildspec.yml. Also incorrectly handling scp/ssh                                                                                                                                                                                                                                                                                                                                                                     | (1) Using Systems Manager Parameter store, create a DATABASE_PASSWORD secure string parameter then remove it from the env var. (2) Configure CodeBuild project to use an IAM Role with the required permissions and remove the AWS cred from buildspec.yml file. Run scp/ssh commands using Systems Manager Run Command                                                                                                                                                                                                       |
| 12 on-demand EC2 instances across 3 AZs using Golden AMI. Each instance has only 10% utilization after business hours but increase to 30% during peak hours. There are also 3rd party apps that use the app from all over the globe with no specific schedule. In the morning, there’s always a sudden CPU utilization increase. However, CPU utilization usually stabilizes after a few hours.                                                    | Set up ASG using golden AMI with a scaling action based on the CPU utilization average. Configure a scheduled action for the group to adjust the min number of EC2 instances to 3 after business hours end, and reset to 6 before business hours begin                                                                                                                                                                                                                                                                        |
| Online forum should support searches within `ForumName` for items where `Subject` begins with a particular letter. It should allow fetches of items within the given `LastPostDateTime` timeframe as well as the capability to return the threads that have been posted within the last quarter                                                                                                                                                    | set the `ForumName` attribute as the primary key and `Subject` as the sort key. Create a Local Secondary Index with `LastPostDateTime` as the sort key and the `Thread` as a projected attribute                                                                                                                                                                                                                                                                                                                              |
| Prevent anyone from bypassing CloudFront distribution and disable direct access from S3 URLs                                                                                                                                                                                                                                                                                                                                                       | Create an Origin Access Control (OAC) and associate it with the S3 bucket origin in the CloudFront distribution. Update the bucket policy for the target bucket to allow access only from the specified CloudFront distribution                                                                                                                                                                                                                                                                                               |
| App hosted in ASG of EC2 instances with public IP addresses in a public subnet. Need to fetch/install required system dependencies from Internet upon launch. Most secure solution to solve issue and ensure instances don’t have public internet access                                                                                                                                                                                           | Download all external app dependencies from public internet and then store them to S3 bucket. Set up VPC endpoint for S3 bucket and then assign IAM instance profile to instances in order to allow them to fetch the required dependencies from the bucket                                                                                                                                                                                                                                                                   |
| Deployment stage should release the new app to a small subset of users only for verification before fully releasing the change to all users.                                                                                                                                                                                                                                                                                                       | Define and publish the new version on the serverless application using CloudFormation. Deploy the new version of Lambda functions with CodeDeploy using the `CodeDeployDefault.LambdaCanary10Percent5Minutes` predefined deployment config.                                                                                                                                                                                                                                                                                   |
| Network team uploads a CSV file that contains the latest proxy IP addresses into private S3 bucket. Build a solution to ensure that the apps are accessible from the corporate network in the most cost-effective and minimal effort                                                                                                                                                                                                               | Launch Lambda function to read the list of proxy IP addresses from the S3 bucket. Configure the function to update the ELB security groups to allow HTTPS requests only from the given IP addresses. Use S3 Event Notification to automatically invoke the Lambda function when the CSV file is updated                                                                                                                                                                                                                       |
| Expedite the deployment process of independent Lambda functions                                                                                                                                                                                                                                                                                                                                                                                    | Execute actions for each Lambda function in parallel by setting up a configuration that specifies the same `runOrder` value in CodePipeline                                                                                                                                                                                                                                                                                                                                                                                   |
| AD Connector set up through custom resource in CloudFormation. Created via Lambda function, but CloudFormation is not moving from state CREATE_IN_PROGRESS to CREATE_COMPLETE                                                                                                                                                                                                                                                                      | Make sure that the pre-signed URL obtains a response from the Lambda function code                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| App has no server-side code and is just composed of UI. Sensitive financial data -> adding HTTP response headers such as `X-Content-Type-Options`, `X-Frame-Options` and `X-XSS-Protection` should be implemented to comply with Open Web Application Security Project (OWASP) standards.                                                                                                                                                          | Host the app on S3 bucket configured for website hosting. Set up a CloudFront web distribution and set the S3 bucket as the origin with the origin response event set to trigger a `Lambda@Edge` function. Add the required security headers in the HTTP response using Lambda function                                                                                                                                                                                                                                       |
| Incidents where devs from a specific business unit accidentally terminated eC2 instances owned by another business unit. Only allow a specific business unit who owns the EC2 instance and other resources to terminate their own resources                                                                                                                                                                                                        | Centrally manage all your accounts using AWS Organizations. Group your accounts, which belong to a specific business unit, to individual Organization Units (OU). Set up an IAM Role in prod account which has a policy that allows access to the EC2 instances including resource-level permission to terminate the instances owned by a particular business unit. Associate the cross-account access and IAM policy to every member accounts of the OU.                                                                     |
| Must ensure that all EBS volume in its AWS accounts are encrypted. Set up an automated solution that’ll provide a detailed report of all unencrypted EBS volumes and notify if there is a newly launched EC2 instance which uses an unencrypted volume. Least effort                                                                                                                                                                               | Set up AWS Config rule with a corresponding Lambda function on all target accounts of the company. Collect data from multiple accounts/regions using Config aggregators. Export the aggregated report to S3 bucket then deliver notifications with SNS                                                                                                                                                                                                                                                                        |

# Supporting Notes
- you can’t directly attach an IAM Role to your on-premise servers. You have to set up you on-premise servers as “on-premises instances” in CodeDeploy with a static IAM Role that your servers can assume
- `AWS Application Discovery Service`: helps you plan your migration to AWS cloud by collecting usage and config data about your on-premises servers. Integrated with `AWS Migration Hub`, which simplifies your migration tracking. After performing discovery, you can view the discovered servers, group them into apps, and then track migration status of each application from the Migration Hub console. The discovered data can be exported for analysis in Excel or Athena/QuickSight
- DynamoDB supports two types of secondary indexes:
	- `Global secondary index`: index with a partition key and sort key that can be different from those on the base table. Considered “global” because queries on the index can span all the data with the base table, across all partitions
	- `Local secondary index`: index that has the same partition key as the base table, but a different sort key. “Local” in the sense that every partition of a local secondary index is scoped to a base table partition that has the same partition key value


# Security Services Comparison

| Service   | Description                                                                                                                                                                                                                                                                                                                            |
| --------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Inspector | Automated security assessment service that helps improve the security and compliance of apps deployed on AWS. Automatically assesses applications for exposure, vulnerabilities, and deviations from best practices. After performing an assessment, it produces a detailed list of security findings prioritized by level of security |
| Shield    | A managed Distributed Denial of Service (DDoS) protection service and not an automated security asssessment.                                                                                                                                                                                                                           |
| GuardDuty | A threat detection service that continuously monitors for malicious activity and unauthorized behaviour to protect your AWS accounts                                                                                                                                                                                                   |
| Macie     | A security service that uses ML to automatically discover, classify, and protect sensitive data in AWS                                                                                                                                                                                                                                 |