| Scenario                                                                                                                                                                                                                                                                             | Answer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Ensure that in the event of a failed deployment, there should be in place prevent subsequent deployments. The service must strictly maintain full capacity during API deployment without any reduced capacity to avoid degradation of service                                        | Deploy DynamoDB, Lambda, ES domain using CloudFormation. Deploy changes with a CodeDeploy blue/green deployment. Host the web app in Elastic Beanstalk and set the deployment policy to `Immutable`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Multi-AZ RDS. Need to upgrade RDS instances to latest major version. Ensure minimum downtime when doing the upgrade                                                                                                                                                                  | In the `AWS::RDS::DBInstance` resource type in CloudFormation template, update the `EngineVersion` property to the latest MySQL db version. Create a second app stack and launch a new Read Replica with the same properties as the primary db instance that will be upgraded. Finally, perform and `UpdateStack` operation in CloudFormation                                                                                                                                                                                                                                                                                                                                                                          |
| DynamoDB table must be available in all 3 regions to deliver low-latency data access. When the table is updated in one region, the change must seamlessly propagate to the other regions                                                                                             | Provision a multi-region, multi-active DynamoDB global table that includes the 3 regions                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Making S3 multi-regional. Important assets must always be accessible. Deploy the app to multiple regions. Users must use the same endpoint to access the assets                                                                                                                      | (1) Utilize CloudFormation StackSets to provision a new S3 bucket with versioning enabled in multiple regions. Create several S3 replication rules on the new S3 bucket in the primary region to replicate all its contents to the other regions. Copy the important assets from the existing S3 bucket to the new S3 bucket in the primary region. (2) Create a CloudFront distribution and configure new origins for each bucket. Create an origin group containing all the recently created origins, then modify the default behaviour of the distribution to use the new origin group. (3) Create an alias record in Route53 and configure a simple routing policy that uses the CloudFront distribution as target |
| Adding EC2 instances to handle peak load. But each instance takes more than half an hour to download the required application libraries and become fully configured. Most resilient solution that will lesson deployment time                                                        | Host entire app on Elastic Beanstalk. Create a custom AMI using Systems Manager Automation which includes all the dependencies. Configure EB env to have an ASG of EC2 instances across multi-AZ with a load balancer in front. Enable DynamoDB Auto Scaling and point the application DNS record to the EB load balancer using Route53.                                                                                                                                                                                                                                                                                                                                                                               |
| Must be HA during deployment of new portal version and be able to roll back changes if necessary. Need to search/filter server logs in near-real-time for monitoring purposes                                                                                                        | Using Elastic Beanstalk, host the multi-tier Node.js web portal in a load-balancing and autoscaling env. Set up RDS MySQL database with a multi-AZ deployment config that is **decoupled** from Elastic Beanstalk stack. Set log options to stream the app logs to CloudWatch Logs with 90 day retention                                                                                                                                                                                                                                                                                                                                                                                                               |
| All data in S3 must be encrypted both at rest and in transit. All of its data must also be replicated in 2 locations that are >450 miles apart from each other                                                                                                                       | Set up primary/secondary S3 buckets in 2 separate regions that are >450 miles apart. Create a **bucket policy** to enforce access to the buckets only through HTTPS and enforce **S3-Managed Keys (SSE-S3)** encryption on all objects uploaded to the bucket. Enable **cross-region replication (CRR)** between the two buckets                                                                                                                                                                                                                                                                                                                                                                                       |
| Web portal needs cross-region failover. Stores data in Aurora in primary region with Parallel Query feature enabled to optimize I/O computation performance. It uses Route53 to direct customer traffic to active region. Minimize downtime in the event that primary db fails       | Launch a read replica of the primary db to the second region. Set up RDS Event Notification to publish status updates to an SNS topic. Create a Lambda function subscribed to the topic to monitor db health. Configure Lambda to promote the read replica as the primary in the event of a failure. Update Rotue53 record to redirect traffic from the primary region to secondary region                                                                                                                                                                                                                                                                                                                             |
| Need to decouble RDS from ElasticBeanstalk because if you terminate the env, db goes down as well. Least amount of data loss                                                                                                                                                         | Decouple RDS instance from Elastic Beanstalk env using B/G deployment strategy to decouple. Take RDS DB snapshot and enable deletion protection. Set up a new Elastic Beanstalk env with the necessary info to connect to RDS instance. Before terminating the old Elastic Beanstalk env, remove its security group rule first before proceeding                                                                                                                                                                                                                                                                                                                                                                       |
| ASG of EC2 instances in multi-AZ, traffic managed by ALB. RDS for db, incoming traffic is routed to load balancer through Route53. Implement a geographically isolated disaster recovery site to enrue business continuity. Required RPO is 5 min, RTO 2hrs. Least amount of changes | Clone the app stack except for RDS in diff region. Create Read Replicas in the new region and configure the new app stack to point to the local RDS db instance. Set up a failover routing policy in Route53 that will auto rote traffic to the new app stack in the event of an outage                                                                                                                                                                                                                                                                                                                                                                                                                                |
| ASG EC2 in multi-AZ behind ALB. Using RDS multi-AZ deployment config. All static content stored in S3. Using CloudFormation templates. Implement multi-region disaster recovery plan with lowest recovery time and least data loss                                                   | Launch app stack in another region using CloudFormation template. Create RDS Read Replica in another  region and enable cross-region replication between the original S3 bucket and new bucket. Promote RDS Read Replica as the master in the event of app failover. Increase the capacity of ASG using CloudFormation stack template to improve the scalability of app                                                                                                                                                                                                                                                                                                                                                |
| Implement solution to improve RTO/RPO of website for cross-region failover                                                                                                                                                                                                           | Use Step Functions with 2 Lambda functions that calls the RDS API to create a snapshot of the db, create a cross-region snapshot copy, and restore the db instance from a snapshot in the backup region. Use EventBridge to trigger the function to take a db snapshot every hour. Set up SNS topic that will receive published messages from Healthy API, RDS availability, and other events that will trigger the Lambda function to create cross-region snapshot copy. During failover, configure Lambda function to restore the db from a snapshot in the backup region                                                                                                                                            |
| Moving to serverless. Deployment of the succeeding new version of app must initially rolled out to a small number of users first for testing before the full release. If post-hook test fails, there should be an wasy way to roll back the deployment.                              | (1) Set up canary deployment in API Gateway that routes 20% of incoming traffic to the canary release. Promote the canary release to prod once the initial tests have passed. (2) Set up one Lambda Function Alias that points to both the current and new versions. Route 20% of incoming traffic to the new version and once it's considered stable, update the alias to route all traffic to new version                                                                                                                                                                                                                                                                                                            |

# Notes
- `Immutable` deployment performs an immutable update to launch a full set of new instances running the new version of app in separate ASG, alongside the instances running the old version. Can prevent issues caused by partially completed rolling deployments. If the new instances don't pass health check, Elastic Beanstalk terminates them, leaving the original instance untouched 
- `DynamoDB global table` provide automatic multi-active replication to regions worldwide. Global tables don't have read replicas
- `S3 Replication` enables automatic, asynchronous copying of objects across S3 buckets. Destination buckets can be in different region. Requires the source/destination buckets to have versioning enabled
- `CloudFront origin group` can be used to configure origin failover for scenarios when you need HA. Use origin failover to designate primary origin for CF + second origin that CF automatically switches when the primary origin returns specific HTTP status code failure responses
- RDS instance attached to Elastic Beanstalk env is ideal for dev/testing env. It's not ideal for prod env because the lifecycle of the database instance is tied to the lifecycle of your app env. If you terminate the env, you will lose your data because RDS instance is deleted by the environment. 
- You can't create S3 buckets in 2 separate AZs since it is a regional service
- `RDS cross-region snapshot` doesn't provide a high RPO/RTO compared to Read Replica since snapshots take significant time to complete. Although it's better than multi-AZ deployments  since you can replicate your db across regions, using a Read Replica is still the best choice for providing a high RTO/RPO for disaster recover
- `RDS Multi-AZ` spans multi-AZ within a single region only, and not to an entirely new region. You can't deploy a standby db instance in the new region 
- **You can replicate DB instances across regions as part of your disaster recovery strategy, which is not available with multi-AZ deployment since it's only applicable in a single region**
- `Aurora multi-master` feature that allows multiple read/write instances in an Aurora cluster, enabling HA and fault tolerance across multiple AZs. Replicates data across multi AZ only and not to another  region (Use `Aurora Global Database` for multi-region instead)
- You can connect your Elastic Beanstalk environment to a db by adding a rule to your db security group that allows ingress from the autogenerated security group that Elastic Beanstalk attaches to your env's ASG.
- ELB can't distribute traffic to diff regions, unlike Route53
- There's no Canary routing option for ALB
- NLB doesn't support weighted target groups, unlike ALB