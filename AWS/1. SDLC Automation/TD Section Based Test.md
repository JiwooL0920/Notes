
| Scenario                                                                                                                                                                                            | Answer                                                                                                                                                                                                                                                                                                                                                                                                                       |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Deployed to ECS, need to run validation script before allowing prod traffic                                                                                                                         | Create validation script in Lambda and define them on `AfterAllowTestTraffic` lifecycle hook                                                                                                                                                                                                                                                                                                                                 |
| Trigger job in ECS when files are uploaded/deleted from S3 bucket. Object level logging is already enabled                                                                                          | Create 2 EventBridge rule to detect S3 object: PUT -> set target to ECS cluster to run a new ECS Task, DELETE -> set target to Lambda function to stop all ECS tasks with API call                                                                                                                                                                                                                                           |
| EC2 running behind ASG. Deploy duplicate fleet, keep original fleet unaltered. Shift traffic once completely deployed, and auto terminate original fleet 1hr after.                                 | CodeDeploy set up blue/green deployment group. Setup `BlueInstanceTerminationOption` action to `TERMINATE` and `terminationWaitTimeInMinutes` to 1hr                                                                                                                                                                                                                                                                         |
| ECS - Keep db credentials in dedicated storage with lifecycle management and key rotation                                                                                                           | If you want a single store for configuration and secrets, you can use Parameter Store. If you want a dedicated secrets store with lifecycle management, use Secrets Manager                                                                                                                                                                                                                                                  |
| Codebuild is downloading from S3 in unauthenticated manner. Enhance it                                                                                                                              | Secure the S3 bucket by removing unauthenticated access thru a bucket policy. Update the service role of the CodeBuild project to grant access to S3. Download the db scripts using AWS CLI                                                                                                                                                                                                                                  |
| Project code on GitHub. Everytime the repo is updated, the code must be compiled, tested, and uploaded to S3                                                                                        | (1) Setup a GitHub webhook that will initiate a build process whenever there's a modification to repo. (2) Provision a CodeBuild project that utilizes GitHub as source repo. (3) Include a buildspec.yml file in the source code                                                                                                                                                                                            |
| Deploying critical app with Elastic Beanstalk using `Rolling` deployment policy. It has an RDS DB instance attached to it. Deployment failed and you had to redeploy old version. Prevent it        | Configure `Immutable` as the deployment policy in your Elastic Beanstalk environment --> ensures that config changes that require replacing instances are applied efficiently/safely. If an immutable env update fails, the rollback process requires only terminating an ASG. (B/G is incorrect bc it requires your env to run independently of your prod db)                                                               |
| Need a solution to collect all app/server logs effectively (EC2, multi-AZ behind ALB). Should be able to perform root cause analysis based on logs, even if ASG immediately terminated the instance | Delay termination of unhealthy EC2 instance by adding a lifecycle hook to ASG to move instances in `Terminating` state to `Terminating:Wait` state. Create EventBridge rule for `EC2 Instance-terminate Lifecycle Action` Auto Scaling Event with an associated AWS Systems Manager Automation Document. Trigger CloudWatch agent to push app logs and resume instance termination once all logs are sent to CloudWatch Logs |
| ECS in VPC. Need an app to detect where high latencies are occurring and determining specific services and paths impacting app performance                                                          | Produce a Docker image that runs the X-Ray daemon. Upload the image to a Docker image repository, and then deploy it to your ECS cluster. Configure network mode settings and port mappings in your **task definition file** to allow traffic on **UDP** port 2000                                                                                                                                                           |
|                                                                                                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                              |


